name: CI


on: [push, pull_request]


jobs:
  msvc:
    name: MSVC

    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v3

      - name: "Setup Conda"
        uses: conda-incubator/setup-miniconda@v2
        with:
          miniconda-version: "latest"
          channels: conda-forge
        run: |
          conda install --yes gmp
          conda install --yes mpfr
          conda install --yes pthreads-win32

      - name: "Setup MSVC"
        uses: ilammy/msvc-dev-cmd@v1
        with:
          arch: x86_64

      - name: "Configure"
        run: |
          mkdir build
          cd build
          set "CFLAGS=/wd4146 /wd4018 /wd4267 /wd4244"
          set "FLINT_TEST_MULTIPLIER=1"
          cmake -G "Ninja" -DBUILD_TESTING=ON -DCMAKE_BUILD_TYPE=Release ..

      - name: "Build"
        run: |
          cmake --build . -- -j4

      - name: "Test"
        run: |
          ctest -j4 --output-on-failure --timeout 100
